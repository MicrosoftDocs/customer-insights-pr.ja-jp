---
title: データ統合でエンティティをマージする
description: エンティティをマージして、統合顧客プロファイルを作成します。
ms.date: 01/28/2022
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: tutorial
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
searchScope:
- ci-merge
ms.openlocfilehash: eb08ab38d23bf22a17896b63c93e6821431b002a
ms.sourcegitcommit: 3807202283dd116a30f900a163d8141db621e5a8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/28/2022
ms.locfileid: "8046570"
---
# <a name="merge-entities"></a>エンティティの結合

マージ フェーズはデータ統合プロセスの最後のフェーズです。 その目的は、競合するデータを調整することです。 競合するデータの例としては、2 つのデータ セットで見つかったがそれぞれに少しずつ異なって表示される顧客名 ("Grant Marshall" と "Grant Marshal") や、形式が異なる電話番号 (617-803-091X と 617803091X) などがあります。 これらの競合するデータ ポイントのマージは、属性ごとに行われます。

:::image type="content" source="media/merge-fields-page.png" alt-text="統合された顧客プロファイルを定義するマージされたフィールドを持つテーブルを表示するデータ統合プロセスのマージ ページ。":::

[一致フェーズ](match-entities.md) が完了したら、**統合** ページで **マージ** タイルを選択して、マージ フェーズを開始できます。

## <a name="review-system-recommendations"></a>システム レコメンデーションのレビュー

**データ** > **統合** > **マージ** で、統合された顧客プロファイル エンティティ内でマージする属性を選択して除外します。 統合された顧客プロファイルは、データ統合プロセスの結果です。 一部の属性は、システムによって自動的にマージされます。

自動的にマージされた属性の 1 つに含まれる属性を表示するには、そのマージされた属性をテーブルの **顧客フィールド** タブで選択します。 マージされた属性を構成する属性は、マージされた属性の下の 2 つの新しい行に表示されます。

## <a name="separate-rename-exclude-and-edit-merged-fields"></a>マージされたフィールドの分離、名前変更、除外、および編集

システムがマージされた属性を処理する方法を変更して、統合された顧客プロファイルを生成できます。 **詳細表示** を選択して、変更する項目を選択します。

:::image type="content" source="media/manage-merged-attributes.png" alt-text="マージされた属性を管理するための詳細表示ドロップダウン メニューのオプション。":::

詳細については、次のセクションを参照してください。

## <a name="separate-merged-fields"></a>マージされたフィールドの分離

マージされたフィールドを分離するには、テーブルで属性を見つけます。 分離されたフィールドは、統合された顧客プロファイルの個別のデータ ポイントとして表示されます。 

1. マージされたフィールドを選択します。
  
1. **詳細表示** を選択し、**フィールドの分離** を選択します。
 
1. 分離を確認します。

1. **保存** と **実行** を選択し、変更を処理します。

## <a name="rename-merged-fields"></a>マージされたフィールドの名前を変更

マージされた属性の表示名を変更します。 出力エンティティの名前は変更できません。

1. マージされたフィールドを選択します。
  
1. **詳細表示** を選択し、**名前の変更** を選択します。

1. 変更した表示名を確認します。 

1. **保存** と **実行** を選択し、変更を処理します。

## <a name="exclude-merged-fields"></a>マージされたフィールドの除外

統合された顧客プロファイルから属性を除外します。 フィールドがセグメントなどの他のプロセスで使用されている場合は、顧客プロファイルから除外する前に、これらのプロセスから削除します。 

1. マージされたフィールドを選択します。
  
1. **詳細表示** を選択し、**除外** を選択します。

1. 除外を確認します。

1. **保存** と **実行** を選択し、変更を処理します。 

**マージ** ページで **除外されたフィールド** を選択して、除外したすべてのフィールドのリストを表示します。 このペインでは、除外されたフィールドを再び追加できます。

## <a name="edit-a-merged-field"></a>マージされたフィールドを編集する

1.  マージされたフィールドを選択します。

1.  **詳細表示** を選択し、**編集** を選択します。

1.  フィールドの結合、あるいはマージする方法を、次の 3 つのオプションのいずれかから指定します:
    - **重要性**: 参加フィールドに指定された重要度ランクに基づいて勝者の値を識別します。 既定のマージ オプションです。 **上/下に移動** を選択し、重要度ランキングを設定します。
    :::image type="content" source="media/importance-merge-option.png" alt-text="フィールドのマージ ダイアログの重要性オプション。"::: 
    - **最新**: 最新性に基づいて、勝者の値を特定します。 最新性の定義には、マージ フィールド スコープのすべての参加エンティティに日付または数値フィールドが必要となります。
    :::image type="content" source="media/recency-merge-option.png" alt-text="フィールドのマージ ダイアログの最新性オプション。":::
    - **最も古い**: 古さに基づいて、勝者の値を特定します。 最新性の定義には、マージ フィールド スコープのすべての参加エンティティに日付または数値フィールドが必要となります。

1.  マージ プロセスに参加するフィールドをさらに追加できます。

1.  マージしたフィールドの名前を変更することも可能です。

1. **完了** を選択して変更を適用します。

1. **保存** と **実行** を選択し、変更を処理します。 

## <a name="combine-fields-manually"></a>フィールドを手動で結合

マージされた属性を手動で指定します。

1. **マージ** ページで **結合** を選択します。

1. **フィールド** オプションを選択します。

1. **フィールドの結合方法** ドロップダウンでマージにおける勝者のポリシーを指定します。

1. フィールドを選択して追加します。 **フィールドの追加** を選択して、さらにフィールドを結合します。

1. **名前** と **出力フィールド名** を指定します。

1. **完了** を選択して変更を適用します。

1. **保存** と **実行** を選択し、変更を処理します。 

## <a name="combine-a-group-of-fields"></a>フィールドのグループの結合

フィールドのグループを 1 つのユニットとして扱います。 たとえば、レコードにフィールド Address1、Address2、City、State、Zip が含まれている場合です。 データをより完全なものにするために、異なるレコードの Address2 にマージすることはおそらくないでしょう

1. **マージ** ページで **結合** を選択します。

1. **フィールドのグループ** オプションを選択します。

1. **グループの順位付け** ドロップダウンでマージにおける勝者のポリシーを指定します。

1. **追加** を選択し、さらにフィールドを追加するか、フィールドにグループを追加するかを選択します。

1. 結合されたすべてのフィールドの **名前** と **出力名** を指定します。

1. フィールドのグループの **名前** を指定します。 

1. **完了** を選択して変更を適用します。

1. **保存** と **実行** を選択し、変更を処理します。

## <a name="change-the-order-of-fields"></a>フィールドの順序の変更

一部のエンティティには、他のエンティティよりも多くの詳細が含まれています。 エンティティにフィールドに関する最新データが含まれている場合、値をマージするときに他のエンティティより優先することができます。

1. マージされたフィールドを選択します。
  
1. **詳細表示** を選択し、**編集** を選択します。

1. **フィールドの結合** ペインで、**上/下へ移動** を選択し順序を設定するか、目的の位置にドラッグ アンド ドロップします。

1. 変更を確認します。

1. **保存** と **実行** を選択し、変更を処理します。

## <a name="configure-customer-id-generation"></a>顧客 ID の生成を構成する 

マージするフィールドを設定した後、顧客プロファイルの一意の識別子である CustomerId の値を生成する方法を定義できます。 データ統合プロセスのマージ ステップでは、一意の顧客プロファイル識別子が生成されます。 識別子は、データ統合プロセスの結果である *顧客* エンティティの CustomerId です。 

顧客エンティティ の CustomerId は、 非 null の勝者の 主キーの 第一 値 のハッシュに基づいています。 これらのキーは、一致およびマージの段階で使用されるエンティティから取得されるため、 一致の順序に影響を受けます。 そのため、一致順序の主エンティティで主キーの値が変更されると、生成される CustomerID が変更される可能性があります。 したがって、主キーの値 が常に同じ顧客を表すとは限りません。

安定した顧客 ID を構成することで、このような動作を回避できます。

**一意の顧客 ID を構成する**

1. **統合** > **マージ** にアクセスします。

1. **キー** タブを選択します。 

1. **顧客 ID** 行にカーソルを合わせ、**構成** オプションを選択します。
   :::image type="content" source="media/customize-stable-id.png" alt-text="ID 生成のカスタマイズに使用するコントロール。":::

1. 一意の顧客 ID を構成し、より安定した最大 5 つのフィールドを選択します。 構成と一致しないレコードは、代わりにシステムが構成した ID を使用します。  

1. **完了** を選択し、マージ プロセスを実行して変更を適用します。

## <a name="group-profiles-into-households-or-clusters"></a>プロファイルを世帯またはクラスターにグループ化します

顧客プロファイル生成構成プロセスの一部として、関連するプロファイルをクラスターにグループ化するルールを定義できます。 現在利用可能なクラスターには、家庭用クラスターとカスタム クラスターの 2 種類があります。 *Customer* エンティティにセマンティック フィールド *Person.LastName* と *Location.Address* が含まれる場合、システムは事前定義されたルールを持つ世帯を自動的に選択します。 [一致ルール](match-entities.md#define-rules-for-match-pairs)のように、独自のルールと条件を使用してクラスターを作成することもできます。

**世帯またはクラスターを定義する**

1. **統合** > **マージ** にアクセスします。

1. **マージ** タブで、**高度** > **クラスターを作成する** を選択します。

   :::image type="content" source="media/create-cluster.png" alt-text="新しいクラスターを作成するためのコントロール。":::

1. **世帯** または **カスタム** クラスターを選択します。 セマンティック フィールド *Person.LastName* と *Location.Address* が *Customer* エンティティに存在する場合、世帯が自動的に選択されます。

1. クラスターの名前を入力して、**完了** を選択します。

1. **クラスター** タブを選択して、作成したクラスターを検索します。

1. クラスターを定義するためのルールと条件を指定します。

1. **実行** を選択して、マージ プロセスを実行し、クラスターを作成します。

マージ プロセスの実行後、クラスター識別子は新しいフィールドとして *Customer* エンティティに追加されます。

## <a name="run-your-merge"></a>マージを実行する

手動で属性をマージする場合でも、システムに属性をマージさせる場合でも、いつでもマージを実行できます。 **マージ** ページで **実行** を選択して、このプロセスを開始します。

> [!div class="mx-imgBorder"]
> ![データ マージの保存と実行。](media/configure-data-merge-save-run.png "データ マージの保存と実行")

**マージのみ実行** は、統合された顧客エンティティに反映された出力のみを表示する場合に選択します。 ダウンストリーム プロセスは [更新スケジュールで定義](system.md#schedule-tab) されたように更新されます。

**マージおよびダウンストリーム プロセスの実行** を選択して、変更内容でシステムを更新します。 エンリッチメント、セグメント、メジャーを含むすべてのプロセスが自動的に再実行されます。 すべてのダウンストリーム プロセスが完了すると、顧客プロファイルに変更が反映されます。

さらに変更を加えてステップを再実行するには、進行中のマージをキャンセルします。 **更新中 ...** テキストを選択して、表示された横ウィンドウの下にある **ジョブをキャンセル** を選択します。

[!INCLUDE [progress-details-include](../includes/progress-details-pane.md)]

:::image type="content" source="media/process-detail-path.png" alt-text="タスクステータスリンクからプロセスの詳細にアクセスするためのドリルダウンパス。":::

## <a name="next-step"></a>次のステップ

[活動](activities.md)、[エンリッチメント](enrichment-hub.md)、または [関連付け](relationships.md) を設定して、顧客に関するより多くのインサイトを取得します。

アクティビティ、エンリッチメント、またはセグメントをすでに構成している場合、最新の顧客データを使用するように自動的に処理されます。

[!INCLUDE[footer-include](../includes/footer-banner.md)]
