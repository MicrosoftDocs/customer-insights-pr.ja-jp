---
title: データ統合のためにエンティティを照合する
description: データを照合して、統合顧客プロファイルを作成します。
ms.date: 10/14/2020
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: conceptual
author: m-hartmann
ms.author: mhart
ms.reviewer: adkuppa
manager: shellyha
ms.openlocfilehash: 78549037f9c9e59329f5423c36eeb058128802c0
ms.sourcegitcommit: cf9b78559ca189d4c2086a66c879098d56c0377a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/03/2020
ms.locfileid: "4406190"
---
# <a name="match-entities"></a>エンティティを一致させる

一致フェーズが完了すると、エンティティを一致させる準備が整います。 一致フェーズでは、データセットを統合して顧客プロファイルデータセットを統合する方法を指定します。 一致フェーズには少なくとも [2 つのマッピングされたエンティティ](map-entities.md) が必要です。

## <a name="specify-the-match-order"></a>一致順を指定します。

**統合** > **一致** へ移動して、**順序を設定** を選択して一致フェーズを開始します。

各一致により、2 つ以上のエンティティが単一のエンティティに統合され、一意の顧客レコードがそれぞれ保持されます。 次の例では、3 つの例を選択しました : **ContactCSV: TestData** を **主** エンティティとして、**WebAccountCSV: TestData** を **エンティティ 2** として、そして **CallRecordSmall: TestData** を **エンティティ 3** としてです。 上の図では、選択は一致順序がどのように実行されるかを示しています。

> [!div class="mx-imgBorder"]
> ![データの一致順序を編集する](media/configure-data-match-order-edit-page.png "データの一致順序を編集する")
  
**主** エンティティが、**エンティティ 2** と一致する。 最初の一致からの結果となるデータセットは **エンティティ 3** です。
この例では、2 つの一致のみを選択しましたが、システムはさらに多くの一致をサポートできます。

> [!IMPORTANT]
> **主** エンティティとして選択したエンティティは、統合マスター データセットの基盤として機能します。 一致フェーズで選択された追加のエンティティは、このエンティティに追加されます。 同時に、これは統合されたエンティティがこのエンティティに含まれるデータの *すべて* が含まれることは意味しません。
>
> エンティティの階層を選択する際に役立つ 2 つの考慮事項があります。
>
> - 顧客に関する最も完全で信頼性の高いデータを持つことを検討しているエンティティは何ですか？
> - 今特定したエンティティには、その他のエンティティ (名前、電話番号、メールアドレスなど) でも共有される属性がありますか？ そうでない場合は、2 番目に信頼性の高いエンティティを選択します。

**完了** を選択して、一致順を保存します。

## <a name="define-rules-for-your-first-match-pair"></a>最初の一致ペアのルールを定義する

一致順序を指定した後、**一致** ページで定義された一致が表示されます。 画面上部のタイルには、一致順序を実行するまで空欄です。

> [!div class="mx-imgBorder"]
> ![ルールを定義する](media/configure-data-match-need-rules.png "ルールを定義する")

**ルールが必要** 警告は、一致ペアに対して一致ルールが定義されていないことを示唆しています。 一致ルールは、エンティティの特定のペアが一致するロジックを指定します。

1. 最初のルールを定義するには、一致テーブル (1) で対応する一致行を選択することで **ルール定義** ウィンドウを開いてから、**新しいルールを作成** (2) を選択します。

   > [!div class="mx-imgBorder"]
   > ![新規ルールの作成](media/configure-data-match-new-rule2.png "新規ルールの作成")

2. **ルールを編集** ウィンドウで、そのルールの条件を構成します。 各条件は、必須の選択を含む 2 つの行で表されます。

   > [!div class="mx-imgBorder"]
   > ![新規ルール ウィンドウ](media/configure-data-match-new-rule-condition.png "新規ルール ウィンドウ")

   エンティティ/フィールド (最初) - 最初の一致ペア エンティティからの一致に使用される属性。 例には、電話番号またはメールアドレスが含まれます。 顧客に固有である可能性が高い属性を選択します。

   > [!TIP]
   > 活動の種類の属性に基づいた一致は避けます。 言い換えれば、属性が活動であると思われる場合、一致基準としては不十分な場合があります。  

   エンティティ/フィールド (2 番目) - 2 番目の一致ペア エンティティからの一致に使用される属性。

   正規化 - **正規化の方法** : 選択した属性に対してさまざまな正規化オプションがあります。 たとえば、句読点の削除またはスペースの削除

   組織名の正規化 (プレビュー) では、**種類 (電話、名前、組織)** を選択することもできます。

   > [!div class="mx-imgBorder"]
   > ![正規化-B2B](media/match-normalization-b2b.png "正規化-B2B")

   精度レベル - この条件に使用される精度のレベル。 一致条件の精度レベルの設定には、**ベーシック** そして **カスタム** の 2 つのタイプがあります。  
   - 基本 : 低、中、高、および完全から選択する 4 つのオプションを提供します。 **完全** を選択して、100％ に一致するレコードのみを一致させます。 その他のレベルの 1 つを選択して、100％ 同一ではないレコードに一致させます。
   - カスタム : スライダーを使用して、レコードが一致する必要があるカスタムパーセンテージを定義するか、**カスタム** フィールドに値を入力します。 システムは、このしきい値を通過したレコードのみを照合一致ペアとして照合します。 スライダーの値は 0 から 1 の間になります。 0.64 は 64％ を表します。

3. **完了** を選択してルールを保存します。

### <a name="add-multiple-conditions"></a>複数の条件を追加する

複数の条件が満たされた場合にのみエンティティを一致させるには、AND 演算子でリンクされている条件をさらに追加します。

1. **ルールを編集** ウィンドウで、**条件を追加** を選択します。 既存の条件の横にある削除ボタンを選択して、条件を削除することもできます。

2. **完了** を選択して、ルールを保存します。

## <a name="add-multiple-rules"></a>複数のルールを追加する

各条件は属性の単一のペアに適用されますが、ルールは条件のセットを表します。 エンティティをさまざまな属性セットに一致させるために、ルールを追加できます。

1. 対象者に関するインサイトで、**データ** > **統合** > **照合** に移動します。

2. 更新するエンティティを選択し、**ルールを追加** を選択します。

3. [最初の一致ペアのルールを定義する](#define-rules-for-your-first-match-pair) で概略された手順に従ってください。

> [!NOTE]
> ルールの順序が重要です。 一致アルゴリズムは、最初のルールに基づいて一致を試み、最初のルールで一致が識別されなかった場合にのみ 2 番目のルールに進みます。

## <a name="define-deduplication-on-a-match-entity"></a>照合エンティティで重複排除を定義する

上記のセクションで概説したように、エンティティ間の照合ルールを指定するだけでなく、重複排除ルールも指定できます。 *重複排除* はプロセスです。 重複するレコードを識別し、それらを 1 つのレコードにマージして、すべてのソース レコードをこのマージされたレコードに、マージされたレコードとは別の ID でリンクします。

重複排除したレコードが識別された後、そのレコードはエンティティ間の照合プロセスで使用されます。 重複排除はエンティティ レベルで実装され、照合プロセスで使用されるすべてのエンティティに適用できます。

### <a name="add-deduplication-rules"></a>重複排除ルールの追加

1. 対象者に関するインサイトで、**データ** > **統合** > **照合** に移動します。

1. **マージした重複** セクションで、**エンティティの設定** を選択します。

1. **基本設定をマージする** セクションで、重複排除を適用するエンティティを選択します。

1. 重複レコードをマージする方法を指定し、次の 3 つのマージ オプションのいずれかを選択します:
   - *最も多く入力された*: 最も多く入力された属性を持つレコードを勝者レコードとして識別します。 これは既定のマージ オプションです。
   - *最も新しい*: 最新性に基づいて勝者レコードを識別します。 最新性を定義するには、日付または数値フィールドが必要です。
   - *最も古い*: 最も古いレコードに基づいて勝者レコードを識別します。 最新性を定義するには、日付または数値フィールドが必要です。
 
   > [!div class="mx-imgBorder"]
   > ![重複排除ルール ステップ 1](media/match-selfconflation.png "重複排除ルール ステップ 1")
 
1. エンティティを選択して、マージの基本設定を設定したら、**新しいルールの作成** を選択して、エンティティ レベルで重複排除ルールを定義します。
   - **フィールドの選択** には、ソース データを重複排除するエンティティから使用可能なすべてのフィールドが一覧表示されます。
   - エンティティ間の照合で指定されたのと同様の方法で、正規化と精度の設定を指定します。
   - **条件の追加** を選択して、追加の条件を定義できます。
 
   > [!div class="mx-imgBorder"]
   > ![重複排除ルール ステップ 2](media/match-selfconflation-rules.png "重複排除ルール ステップ 2")

  エンティティに対して複数の重複排除ルールを作成できます。 

1. 照合プロセスを実行すると、重複排除ルールで定義された条件に基づいてレコードがグループ化されます。 レコードをグループ化した後、マージ ポリシーを適用して、勝者レコードを識別します。

1. 次に、この勝者レコードは、エンティティ間の照合に渡されます。

1. 「常に照合する」および「照合しない」に対して定義されたカスタム照合ルールは、重複排除ルールに優先します。 重複排除ルールが一致するレコードを識別し、カスタム照合ルールがそれらのレコードと照合しないように設定されている場合、これら 2 つのレコードの照合は行われません。

1. 照合プロセスを実行すると、重複排除の統計が表示されます。
   
> [!NOTE]
> 重複排除ルールの指定は必須ではありません。 そのようなルールが構成されていない場合は、システム定義ルールが適用されます。 パフォーマンスとシステムの健全性を向上させるために、エンティティ データをエンティティ間の照合に渡す前に、主キーと照合ルールのフィールドの同じ値の組み合わせ (完全一致) を共有するすべてのレコードを 1 つのレコードにまとめます。

## <a name="run-your-match-order"></a>一致オーダーを実行する

エンティティ間の照合や重複排除ルールなどの照合ルールを定義した後、照合順序を実行できます。 **一致** ページで、**実行** を選択してこのプロセスを開始します。 一致アルゴリズムは完了に時間がかかる場合があります。 一致プロセスが完了するまで、**一致** ページでプロパティを変更することはできません。 **エンティティ** ページでで作成された統一された顧客プロファイルエンティティが見つかります。 統一された顧客エンティティは、**ConflationMatchPairs : CustomerInsights** と呼ばれます。

追加の変更を加えてステップを再実行するために、進行中の一致をキャンセルできます。 **更新中 ...** テキストを選択して、表示された横ウィンドウの下にある **ジョブをキャンセル** を選択します。

一致プロセスが完了すると、**更新中 ...** テキストは、**完了** に代わり、ページのすべての機能を再び使用できます。

最初の一致プロセスにより、統一されたマスター エンティティが作成されます。 後続のすべての一致実行により、そのエンティティが拡張されます。

> [!TIP]
> タスク/プロセスには、[6 種類の状態](system.md#status-types) があります。 さらに、ほとんどのプロセスは、[その他の下流プロセスに依存します](system.md#refresh-policies)。 プロセスのステータスを選択して、ジョブ全体の進行状況の詳細を確認できます。 ジョブのタスクの 1 つについて **詳細の表示** を選択すると、処理時間、最終処理日、およびタスクに関連するすべてのエラーと警告などの追加情報が表示されます。

## <a name="review-and-validate-your-matches"></a>一致のレビューと検証

一致ペアの品質を評価し、調整します。

- **一致** ページには、データに関する最初のインサイトを示す 2 つのタイルがあります。

  - **一意の顧客** : システムが識別した一意のプロファイルの数を示します。
  - **一致したレコード** : すべての一致ペアにわたる一致の数を示します。

- **一致順** テーブルでは、この一致ペア エンティティからのレコードの数を、正常に一致したレコードの割合と比較することにより、各一致ペアの結果を評価できます。

- **一致順** テーブルのエンティティの **ルール** セクションで、一致順表では、ルールレベルで正常に一致したレコードの割合がわかります。 ルールの横にあるテーブル シンボルを選択することで、ルール レベルでこれらすべてのレコードを表示できます。 レコードのサブセットをレビューして、それらが正しく一致したことを検証することをお勧めします。

- 条件に応じてさまざまな精度のしきい値を試して、最適な値を特定します。

  1. 実験する一致ペア ルールの省略記号 (...) を選択し、**編集** を選択します。

  2. 実験する状況を選択します。 各基準は、**一致ルール** ウィンドウの 1 つの行によって表示されます。

  3. **基準プレビュー** ページで表示されるものは、条件に選択した精度レベルに依存します。 選択した条件に一致するレコードと一致しないレコードの数を見つけます。

     さまざまなしきい値レベルの影響を十分に理解してください。 各しきい値レベルで一致するレコードの数を比較し、各オプションでレコードを表示できます。 各タイルを選択し、テーブル セクションのデータを確認します。

## <a name="optimize-your-matches"></a>一致を最適化する

次のいくつかの一致パラメーターを再構成して、品質を向上させます。

- **編集** を選択して **一致順を変更** して、一致順フィールドを変更します。

  > [!div class="mx-imgBorder"]
  > ![データの一致順を編集する](media/configure-data-match-order-edit.png "データの一致順を編集する")

- 複数のルールを定義した場合、**ルールの順序を変更** します。 一致ルール グリッドで、**上に移動** と **下に移動** オプションを選択して一致ルールの順序を変えます。

  > [!div class="mx-imgBorder"]
  > ![ルール順序の変更](media/configure-data-change-rule-order.png "ルール順序の変更")

- 一致ルールを定義していて、変更を加えて同様のルールを作成したい場合は、**ルールの複製** をします。 これをおこなうには、**複製** を選択します。

  > [!div class="mx-imgBorder"]
  > ![ルールの複製](media/configure-data-duplicate-rule.png "ルールの複製")

- **編集** シンボルを選択して **ルールを編集します**。 以下の変更を適用します。

  - 条件の属性を変更する : 特定の条件行内の新しい属性を選択します。
  - 条件のしきい値を変更する : 精度スライダーを調整します。
  - 条件の正規化方法を変更する : 正規化方法を更新します。

## <a name="specify-your-custom-match-records"></a>カスタム一致レコードを指定する

特定のレコードが常に照合する、または全く照合すべき条件を指定できます。 これらのルールは、一致プロセスに一括でアップロードできます。

1. **一致順序** 画面で **カスタム一致** オプションを選択します。

   > [!div class="mx-imgBorder"]
   > ![カスタム一致を作成](media/custom-match-create.png "カスタム一致を作成")

2. アップロードされたエンティティがない場合は、一部の詳細に入力する必要がある新しい **カスタム一致** ダイアログボックスが表示されます。 これらの詳細を以前に提供した場合は、手順 8 に進みます。

   > [!div class="mx-imgBorder"]
   > ![新しいカスタム一致ダイアログボックス](media/custom-match-new-dialog-box.png "新しいカスタム一致ダイアログボックス")

3. **テンプレートに記入する** を選択して、どのエンティティのどのレコードが常に一致するか、または一致しないかを指定できるテンプレート ファイルを取得します。 2 つの異なるファイルの「常に一致する」レコードと「全く一致しない」レコードを別々に入力する必要があります。

4. テンプレートには、カスタム一致で使用されるエンティティとエンティティの主キーの値を指定するフィールドが含まれています。 たとえば、営業エンティティの主キー 12345 を取引先担当者エンティティの主キー 34567 と常に一致させる場合は、次のように指定する必要があります。
    - Entity1: Sales
    - Entity1Key: 12345
    - Entity2: Contact
    - Entity2Key: 34567

   同じテンプレート ファイルで、複数のエンティティからカスタム一致レコードを指定できます。

5. 適用するすべてのオーバーライドを追加したら、テンプレート ファイルを保存します。

6. **データ** > **データ ソース** に移動し、テンプレート ファイルを新しいエンティティとして取り込みます。 取り込んだ後、それらを使用して一致構成を指定できます。

7. ファイルをアップロードした後、エンティティが利用可能になったら、**カスタム一致** オプションをもう一度選択します。 含めるエンティティを指定するオプションが表示されます。 ドロップダウン メニューから必要なエンティティを選択します。

   > [!div class="mx-imgBorder"]
   > ![カスタム一致がオーバーライドします](media/custom-match-overrides.png "カスタム一致がオーバーライドします")

8. **常に一致** と **一致しない** に使用するエンティティを選択して、**完了** を選択します。

9. 今設定したカスタム一致構成のために、**一致** ページで **保存** を選択します。

10. **一致** ページで **実行** を選択して、一致プロセスを開始し、カスタム一致設定が有効になります。 システムに一致したルールは、構成セットによってオーバーライドされます。

11. 一致が完了したら、**ConflationMatchPair** エンティティを確認して、オーバーライドが合成一致に適用されることを確認できます。

## <a name="next-step"></a>次の手順

1 つ以上の一致ペアの一致プロセスを完了した後、データの矛盾の可能性がある場合は [**マージ**](merge-entities.md) トピックを読んで解決することができます。
