---
title: セグメント ビルダーを使用して複雑なセグメントを作成する
description: セグメント ビルダーを使用し、さまざまな属性に基づいてグループ化することにより顧客の複雑なセグメントを作成します。
ms.date: 08/12/2022
ms.subservice: audience-insights
ms.topic: how-to
author: JimsonChalissery
ms.author: jimsonc
ms.reviewer: v-wendysmith
manager: shellyha
searchScope:
- ci-segments
- ci-segment-builder
- ci-segment-details
- customerInsights
ms.openlocfilehash: 7f691fd0b2ea76a2960d5adf766a4b166f02ebb4
ms.sourcegitcommit: 267c317e10166146c9ac2c30560c479c9a005845
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/16/2022
ms.locfileid: "9304755"
---
# <a name="create-complex-segments-with-segment-builder"></a>セグメント ビルダーを使用して複雑なセグメントを作成する

統合された顧客または統合された取引先担当者、およびその関連エンティティに対して複雑なフィルターを定義します。 各セグメントは処理後、エクスポートしてアクションを実行できる顧客または取引先担当者のレコード セットを作成します。

> [!TIP]
> **個人の顧客** に基づくセグメントには、セグメント メンバーの利用可能な取引先担当者情報が自動的に含まれます。 **ビジネス アカウント** で、取引先企業および取引先担当者の両方を [統合](data-unification.md)する場合は、セグメントが取引先企業か業務担当者のどちらに基づくかを選択します。 取引先担当者の情報が必要な宛先にエクスポートする場合は、取引先担当者のセグメントを使用します。 取引先企業の情報が必要な宛先にエクスポートする場合は、取引先企業のセグメントを使用します。

## <a name="segment-builder"></a>セグメント ビルダー

次の画像は、セグメント ビルダーのさまざまな側面を表わしています。 これは、顧客のグループとなるセグメントを示しています。 顧客は特定の概算時間で商品を注文し、報酬ポイントを集めるか、特定の金額を費やしました。

:::image type="content" source="media/segment-builder-overview.png" alt-text="セグメント ビルダーの要素。" lightbox="media/segment-builder-overview.png":::

1. ルールとサブルールを使用してセグメントを整理します。 各ルールまたはサブルールは条件で構成されます。 論理演算子で条件を組み合わせます。

1. ルールに適用されるエンティティ間の[リレーション パス](relationships.md)を選択します。 リレーションシップ パスは、条件で使用できる属性を決定します。

1. ルールとサブルールを管理します。 ルールの位置を変更、または削除します。

1. 条件を追加し、サブルールを使用して適切なレベルのネストを構築します。

1. 接続されたルールにセット操作を適用します。

1. 属性ペインを使用して、利用可能なエンティティ属性の追加、属性に基づいた条件の作成をします。 ペインには、選択したリレーションシップ パスに基づいて、選択したルールで使用可能なエンティティと属性のリストが表示されます。

1. 既存のルールやサブルールに属性に基づく条件を追加したり、新しいルールに追加したりすることができます。

1. セグメントの構築中に変更の取消や、やり直しができます。

上記の例は、セグメント化機能を示しています。 オンラインで 500 ドル以上の商品を購入し、*かつ* ソフトウェア開発に興味を持っている顧客を対象としたセグメントを設定しました。

## <a name="create-a-new-segment-with-segment-builder"></a>セグメント ビルダーを使用して新しいセグメントを作成する

1. **セグメント** に移動します。

1. **新規** > **ユーザー独自の作成** を選択します。 セグメント ビルダー ページで、ルールを定義または作成します。 ルールは、顧客のセットを定義する 1 つ以上の条件で構成されます。

   > [!NOTE]
   > ビジネス アカウントに基づく環境の場合は、作成するセグメントのタイプに基づいて **新規** > **取引先企業のセグメント**、または、**取引先担当者のセグメント (プレビュー)** を選択します。 [取引先企業階層](relationships.md#set-up-account-hierarchies)が定義されていて、子と親の関係に基づいてデータを除外するルールを作成する場合は、**階層を使用しますか? (プレビュー)**、階層を選択し、**適用** します。
   >
   > :::image type="content" source="media/segment_acct_hierarchy.png" alt-text="セグメント選択取引先企業階層ウィンドウ。":::

1. 無題のセグメントの横にある **詳細の編集** を選択します。 セグメントの名前を入力し、セグメントの推奨 **出力エンティティ名** を更新します。 必要に応じて、説明と[タグ](work-with-tags-columns.md#manage-tags)をセグメントに追加します。

   :::image type="content" source="media/segments_edit_details.png" alt-text="[詳細の編集] ダイアログ ボックス。":::

1. **Rule1** セクションで、顧客をフィルタリングするエンティティの属性を選択します。 属性の選択には、次の 2 つの方法があります:
   - **ルールに追加** ペインで利用可能なエンティティと属性のリストを確認し、追加する属性の横にある **+** アイコンを選択します。 既存のルールに属性を追加するか、新規ルールの作成に使用するかを選択します。
   - ルール セクションに属性の名前を入力して、一致する提案を表示します。

1. 演算子を選択して、条件の一致する値を指定します。 属性の値には、数値、文字列、日付、ブール値の 4 つのデータ型のいずれかを持つことができます。 属性のデータ型に応じて、さまざまな演算子を使用して条件を指定できます。

1. **条件の追加** を選択して、ルールに条件を追加します。 現在のルールの配下にルールを作成するには、**サブ ルールの追加** を選択します。

1. ルールが *顧客* エンティティ (または B-to-B の場合は *ContactProfile* エンティティ) 以外のエンティティを使用する場合は、**リレーションシップ パスの設定** を選択し、選択したエンティティを統合された顧客エンティティにマップします。 可能なリレーションシップ パスが 1 つしかない場合、システムはそれを自動的に選択します。 [リレーションシップ パス](relationships.md#relationship-paths)が異なれば、結果も異なる可能性があります。 すべてのルールは、独自のリレーションシップ パスがを持つことができます。

   :::image type="content" source="media/relationship-path.png" alt-text="統合された顧客エンティティにマッピングされたエンティティに基づいてルールを作成する場合の潜在的なリレーションシップ パス。":::

1. ルールに複数の条件がある場合、それらを接続する論理演算子を選択します。  
   - **AND** 演算子: セグメントにレコードを含めるには、すべての条件を満たす必要があります。 このオプションは、異なるエンティティにわたって条件を定義するときに使用します。
   - **OR** 演算子: セグメントにレコードを含めるには、いずれかの条件を満たす必要があります。 このオプションは、同じエンティティにわたって複数の条件を定義するときに使用します。

   :::image type="content" source="media/segmentation-either-condition.png" alt-text="2 つの AND 条件で実行するルール。":::

   OR 演算子を使用する場合は、すべての条件がリレーションシップ パスに含まれるエンティティに基づいている必要があります。

1. さまざまな顧客レコードのセットを作成するには、複数のルールを作成します。 ビジネス案件に必要な顧客を含めるには、グループを連結します。 具体的には、関係パスが指定されているためにルールにエンティティを含めることができない場合は、新しいルールを作成して、そのルールから属性を選択します。

      :::image type="content" source="media/segment-rule-grouping.png" alt-text="セグメントに新しいルールを追加し、演算子を選択します。":::

   1. **ルールの追加** を選択します。
   1. 集合演算子 (**結合**、**交差**、**例外**) のいずれかを選択します。

      - **結合** は 2 つのグループを結合します。
      - **交差** は 2 つのグループが重複しています。 両方のグループに *共通する* データのみが、統合グループで残ります。
      - **例外** は 2 つのグループを結合します。 グループ B のデータでは *一般的ではない* グループのデータのみが、保持されます。

1. 既定では、出力エンティティには、定義されたフィルターに一致する顧客プロファイルのすべての属性が自動的に含められます。 B-to-B で *ContactProfile* を使用する場合、取引先企業 ID が自動的に含まれます。 セグメントが *顧客* エンティティ以外のエンティティに基づいている場合、または *ContactProfile* からさらに属性を含める場合は、**プロジェクトの属性** を選択して、これらのエンティティの属性を出力エンティティに追加します。
 
   例: セグメントは、*Customer* エンティティに関連する購入データを含むエンティティに基づいています。 このセグメントでは、今年商品を購入したスペインの全顧客を検索します。 商品の価格や購入日などの属性を、出力エンティティの一致するすべての顧客レコードに付加することができます。 この情報は、総支出に対する季節的な相関関係の分析に役立つかもしれません。

   :::image type="content" source="media/segments-project-attributes.png" alt-text="サイド ペインで選択した属性を出力エンティティに追加して投影した例。":::
 
   連絡先の属性が予測されたビジネス アカウントに基づくセグメントの出力例は、次のようになります。

   |ID  |アカウント名  |売上  |取引先担当者名  | 取引先担当者ロール|
   |---------|---------|---------|---------|---|
   |10021     | Contoso | 100K | [アビー モス、ルース ソト]  | [CEO、調達マネージャー]

   > [!NOTE]
   > - **プロジェクトの属性** は、*顧客* エンティティまたは *ContactProfile* エンティティと 1 対多いの関係にあるエンティティに対してのみ機能します。 たとえば、1 人の顧客が複数のサブスクリプションを持つことができます。
   > - リレーションシップで定義されているように、投影する属性が *顧客* エンティティまたは *ContactProfile* エンティティから 1 ホップ以上離れている場合、その属性を、構築するセグメント クエリのすべてのルールで使用する必要があります。
   > - 投影する属性が *顧客* エンティティまたは *ContactProfile* エンティティから 1 ホップだけ離れている場合、その属性は、構築するセグメント クエリのすべてのルールに存在する必要はありません。
   > - **予測した属性** は、集合演算子の使用時に考慮されます。

1. **実行** を選択して、セグメントを作成します。 現在の構成を保持し、後でセグメントを実行する場合、**保存** を選択します。 **セグメント** ページが表示されます。

### <a name="segment-builder-tips"></a>セグメント ビルダーのヒント

セグメント ビルダーを使用してセグメントを作成するときは、次のヒントに注意してください。

- セグメント ビルダでは、条件の演算子の設定時にエンティティの有効な値を提案しません。 **データ** > **エンティティ** にアクセスして、エンティティ データをダウンロードして、使用可能な値を確認します。
- 日付に基づく条件を使用すると、固定日付と変動日付範囲を切り替えることができます。
- セグメントに複数のルールがある場合、編集しているルールの横に青い縦線が表示されます。
- ルールと条件は、セグメント定義の他の場所に移動できます。 ルールや条件の横にある垂直の省略記号 (&vellip;) を選択し、それを移動する方法と場所を選択します。
- コマンドバーの **元に戻す** と **やり直し** コントロールを使用すると、変更をロールバックできます。
- セグメントの作成後、一部のセグメントでは [セグメントの使用状況を追跡](segments.md#track-usage-of-a-segment) できます。

## <a name="next-steps"></a>次の手順

[セグメントをエクスポート](export-destinations.md)して、[カスタマー カードとの統合](customer-card-add-in.md)を確認し、他のアプリケーションでセグメントを使用することができます。

[!INCLUDE [footer-include](includes/footer-banner.md)]
